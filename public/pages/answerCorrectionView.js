// answerCorrectionView.js - ÂÆåÂÖ®Êñ∞Ë®≠Ë®à„ÅÆÁ≠îÊ°àÊ∑ªÂâä„Éì„É•„Éº

/**
 * Á≠îÊ°àÊ∑ªÂâä„Éì„É•„Éº„ÇíË°®Á§∫
 */
window.showAnswerCorrectionView = function(quizIndex, subIndex) {
    console.log('üöÄ Á≠îÊ°àÊ∑ªÂâä„Éì„É•„ÉºÈñãÂßã');
    
    // Êó¢Â≠ò„ÅÆ„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíÂâäÈô§
    const existing = document.getElementById('answer-correction-overlay');
    if (existing) existing.remove();
    
    // „Ç™„Éº„Éê„Éº„É¨„Ç§„Çí‰ΩúÊàê
    const overlay = createAnswerCorrectionOverlay();
    document.body.appendChild(overlay);
    
    // Á≠îÊ°à„Ç®„É™„Ç¢„ÇíÂàùÊúüÂåñ
    setTimeout(() => {
        initializeAnswerTextarea();
    }, 100);
    
    console.log('‚úÖ Á≠îÊ°àÊ∑ªÂâä„Éì„É•„ÉºË°®Á§∫ÂÆå‰∫Ü');
};

/**
 * Á≠îÊ°àÊ∑ªÂâä„Ç™„Éº„Éê„Éº„É¨„Ç§„Çí‰ΩúÊàê
 */
function createAnswerCorrectionOverlay() {
    const overlay = document.createElement('div');
    overlay.id = 'answer-correction-overlay';
    overlay.innerHTML = getAnswerCorrectionHTML();
    return overlay;
}

/**
 * Á≠îÊ°àÊ∑ªÂâä„Éì„É•„Éº„ÅÆHTML
 */
function getAnswerCorrectionHTML() {
    return `
        <style>
            #answer-correction-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: #ffffff;
                z-index: 9999;
                display: flex;
                flex-direction: column;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            }
            
            .answer-header {
                background: #f8f9fa;
                padding: 15px 25px;
                border-bottom: 2px solid #e9ecef;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .answer-header h1 {
                font-size: 24px;
                font-weight: bold;
                color: #343a40;
                margin: 0;
            }
            
            .close-btn {
                background: #dc3545;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
                transition: background 0.2s;
            }
            
            .close-btn:hover {
                background: #c82333;
            }
            
            .answer-grid {
                flex: 1;
                display: grid;
                grid-template-columns: 1fr 1fr 1fr 1fr;
                grid-template-rows: 1fr 1fr;
                gap: 15px;
                padding: 20px;
                height: calc(100vh - 80px);
                overflow: hidden;
            }
            
            .grid-section {
                border: 2px solid #dee2e6;
                border-radius: 10px;
                padding: 20px;
                background: white;
                overflow: auto;
                box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            }
            
            .grid-section.articles {
                grid-column: 1;
                grid-row: 1;
            }
            
            .grid-section.qa {
                grid-column: 2;
                grid-row: 1;
            }
            
            .grid-section.answer-writing {
                grid-column: 1 / 3;
                grid-row: 2;
            }
            
            .grid-section.correction {
                grid-column: 3;
                grid-row: 1 / 3;
            }
            
            .grid-section.opinions {
                grid-column: 4;
                grid-row: 1 / 3;
            }
            
            .section-header {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 15px;
                color: #495057;
                border-bottom: 2px solid #e9ecef;
                padding-bottom: 10px;
                display: flex;
                align-items: center;
            }
            
            .section-header .icon {
                margin-right: 8px;
                font-size: 20px;
            }
            
            .answer-writing-area {
                position: relative;
                height: calc(100% - 80px);
                overflow: hidden;
            }
            
            .answer-textarea {
                width: 100%;
                height: 100%;
                border: none;
                outline: none;
                resize: none;
                font-family: 'Courier New', 'MS Gothic', monospace;
                font-size: 16px;
                line-height: 24px;
                letter-spacing: 0.5px;
                background: transparent;
                position: relative;
                z-index: 2;
                padding: 0;
                margin: 0;
                overflow: hidden;
            }
            
            .textarea-background {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                pointer-events: none;
                z-index: 1;
                background-image: repeating-linear-gradient(
                    transparent,
                    transparent 23px,
                    #e9ecef 23px,
                    #e9ecef 24px
                );
            }
            
            .answer-controls {
                margin-top: 15px;
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                align-items: center;
            }
            
            .control-btn {
                background: #007bff;
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                transition: background 0.2s;
            }
            
            .control-btn:hover {
                background: #0056b3;
            }
            
            .control-btn.secondary {
                background: #6c757d;
            }
            
            .control-btn.secondary:hover {
                background: #545b62;
            }
            
            .char-info {
                background: #f8f9fa;
                padding: 8px 12px;
                border-radius: 5px;
                font-size: 13px;
                color: #6c757d;
                border: 1px solid #dee2e6;
            }
            
            .char-info.warning {
                background: #fff3cd;
                color: #856404;
                border-color: #ffeaa7;
            }
            
            .char-info.error {
                background: #f8d7da;
                color: #721c24;
                border-color: #f5c6cb;
            }
            
            .section-content {
                color: #6c757d;
                line-height: 1.6;
            }
            
            .placeholder-text {
                color: #adb5bd;
                font-style: italic;
            }
        </style>
        
        <div class="answer-header">
            <h1>üìù Á≠îÊ°àÊ∑ªÂâä„Éì„É•„Éº</h1>
            <button class="close-btn" onclick="closeAnswerCorrectionView()">‚úï Èñâ„Åò„Çã</button>
        </div>
        
        <div class="answer-grid">
            <!-- Êù°ÊñáË°®Á§∫ -->
            <div class="grid-section articles">
                <div class="section-header">
                    <span class="icon">üìö</span>
                    Êù°Êñá
                </div>
                <div class="section-content">
                    <div class="placeholder-text">Èñ¢ÈÄ£Êù°Êñá„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>
                </div>
            </div>
            
            <!-- Q&A -->
            <div class="grid-section qa">
                <div class="section-header">
                    <span class="icon">‚ùì</span>
                    Q&A
                </div>
                <div class="section-content">
                    <div class="placeholder-text">Ë≥™Âïè„Å®ÂõûÁ≠î„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>
                </div>
            </div>
            
            <!-- Á≠îÊ°à‰ΩúÊàê -->
            <div class="grid-section answer-writing">
                <div class="section-header">
                    <span class="icon">‚úçÔ∏è</span>
                    Á≠îÊ°à‰ΩúÊàêÔºà30ÊñáÂ≠ó√ó23Ë°åÔºâ
                </div>
                <div class="answer-writing-area">
                    <div class="textarea-background"></div>
                    <textarea 
                        id="answer-textarea"
                        class="answer-textarea"
                        placeholder="„Åì„Åì„Å´Á≠îÊ°à„ÇíË®òÂÖ•„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà1Ë°å30ÊñáÂ≠ó„Åæ„Åß„ÄÅÊúÄÂ§ß23Ë°åÔºâ"
                        spellcheck="false"></textarea>
                </div>
                <div class="answer-controls">
                    <button class="control-btn" onclick="clearAnswerText()">üóëÔ∏è „ÇØ„É™„Ç¢</button>
                    <button class="control-btn" onclick="saveDraftAnswer()">üíæ ‰øùÂ≠ò</button>
                    <button class="control-btn" onclick="loadDraftAnswer()">üìÇ Ë™≠Ëæº</button>
                    <button class="control-btn secondary" onclick="insertSampleAnswer()">üìù „Çµ„É≥„Éó„É´</button>
                    <button class="control-btn" onclick="startAICorrection()">ü§ñ AIÊ∑ªÂâä</button>
                    <div class="char-info" id="char-info">0ÊñáÂ≠ó / 0Ë°å</div>
                </div>
            </div>
            
            <!-- Ê∑ªÂâäÁµêÊûú -->
            <div class="grid-section correction">
                <div class="section-header">
                    <span class="icon">üìù</span>
                    Ê∑ªÂâäÁµêÊûú
                </div>
                <div class="section-content" id="correction-result">
                    <div class="placeholder-text">AIÊ∑ªÂâäÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>
                </div>
            </div>
            
            <!-- „Åø„Çì„Å™„ÅÆÊÑèË¶ã -->
            <div class="grid-section opinions">
                <div class="section-header">
                    <span class="icon">üí¨</span>
                    „Åø„Çì„Å™„ÅÆÊÑèË¶ã
                </div>
                <div class="section-content">
                    <div class="placeholder-text">‰ªñ„ÅÆ‰∫∫„ÅÆÊÑèË¶ã„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>
                </div>
            </div>
        </div>
    `;
}

/**
 * Á≠îÊ°à„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÇíÂàùÊúüÂåñ
 */
function initializeAnswerTextarea() {
    const textarea = document.getElementById('answer-textarea');
    if (!textarea) return;
    
    console.log('üéØ Á≠îÊ°à„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢ÂàùÊúüÂåñÈñãÂßã');
    
    // 30ÊñáÂ≠ó„Å´ÊúÄÈÅ©Âåñ„Åï„Çå„Åü„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÇíË®≠ÂÆö
    adjustFontSizeFor30Chars();
    
    // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
    setupAnswerTextareaEvents(textarea);
    
    // „É™„Çµ„Ç§„Ç∫Áõ£Ë¶ñ
    window.addEventListener('resize', handleAnswerViewResize);
    
    console.log('‚úÖ Á≠îÊ°à„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢ÂàùÊúüÂåñÂÆå‰∫Ü');
}

/**
 * 30ÊñáÂ≠ó„Å´„Éï„Ç£„ÉÉ„Éà„Åô„Çã„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÇíË™øÊï¥
 */
function adjustFontSizeFor30Chars() {
    const textarea = document.getElementById('answer-textarea');
    const container = textarea.parentElement;
    
    if (!textarea || !container) return;
    
    // „Ç≥„É≥„ÉÜ„Éä„ÅÆÂÆüÈöõ„ÅÆÂπÖ„ÇíÂèñÂæó
    const containerWidth = container.clientWidth;
    const targetChars = 30;
    
    // „Éë„Éá„Ç£„É≥„Ç∞„ÇíËÄÉÊÖÆ„Åó„ÅüÂÆüÂäπÂπÖ
    const effectiveWidth = containerWidth - 40; // Â∑¶Âè≥20px„Åö„Å§„ÅÆ„Éû„Éº„Ç∏„É≥
    
    // 30ÊñáÂ≠ó„Å´„Å¥„Å£„Åü„ÇäÂêà„ÅÜ„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÇíË®àÁÆó
    let fontSize = Math.floor(effectiveWidth / targetChars * 0.6); // 0.6„ÅØÊñáÂ≠óÂπÖ‰øÇÊï∞
    
    // „Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÅÆÁØÑÂõ≤„ÇíÂà∂Èôê
    fontSize = Math.max(10, Math.min(20, fontSize));
    
    // Á≠âÂπÖ„Éï„Ç©„É≥„Éà„Å™„ÅÆ„ÅßË°å„ÅÆÈ´ò„Åï„ÇÇË™øÊï¥
    const lineHeight = fontSize + 8;
    
    textarea.style.fontSize = fontSize + 'px';
    textarea.style.lineHeight = lineHeight + 'px';
    
    // ËÉåÊôØ„ÅÆ‰∏ãÁ∑ö„ÇÇË™øÊï¥
    const background = textarea.previousElementSibling;
    if (background) {
        background.style.backgroundImage = `repeating-linear-gradient(
            transparent,
            transparent ${lineHeight - 1}px,
            #e9ecef ${lineHeight - 1}px,
            #e9ecef ${lineHeight}px
        )`;
    }
    
    console.log(`üìè „Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫Ë™øÊï¥: ${fontSize}px (Ë°åÈ´ò: ${lineHeight}px)`);
}

/**
 * Á≠îÊ°à„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„ÅÆ„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö
 */
function setupAnswerTextareaEvents(textarea) {
    // ÂÖ•ÂäõÂà∂Âæ°
    textarea.addEventListener('input', function(e) {
        enforceAnswerConstraints(this);
        updateCharacterInfo(this);
    });
    
    // „Ç≠„ÉºÂÖ•ÂäõÂà∂Âæ°
    textarea.addEventListener('keydown', function(e) {
        handleAnswerKeyInput(e, this);
    });
    
    // „Éö„Éº„Çπ„ÉàÂà∂Âæ°
    textarea.addEventListener('paste', function(e) {
        setTimeout(() => {
            enforceAnswerConstraints(this);
            updateCharacterInfo(this);
        }, 10);
    });
    
    console.log('üëÇ Á≠îÊ°à„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Ç§„Éô„É≥„ÉàË®≠ÂÆöÂÆå‰∫Ü');
}

/**
 * Á≠îÊ°à„ÅÆÂà∂Á¥Ñ„ÇíÂÆüË°åÔºà30ÊñáÂ≠ó√ó23Ë°å„ÄÅËá™ÂãïÊîπË°åÔºâ
 */
function enforceAnswerConstraints(textarea) {
    const lines = textarea.value.split('\n');
    const maxLines = 23;
    const maxCharsPerLine = 30;
    
    let modified = false;
    let cursorPos = textarea.selectionStart;
    
    // Ë°åÊï∞Âà∂Èôê
    if (lines.length > maxLines) {
        lines.splice(maxLines);
        modified = true;
        console.log(`‚ö†Ô∏è Ë°åÊï∞Âà∂ÈôêÈÅ©Áî®: ${maxLines}Ë°å„Å´Âà∂Èôê`);
    }
    
    // ÂêÑË°å„ÅÆÊñáÂ≠óÊï∞Âà∂Èôê„Å®Ëá™ÂãïÊîπË°å
    const newLines = [];
    for (let i = 0; i < lines.length; i++) {
        let line = lines[i];
        
        // 30ÊñáÂ≠ó„ÇíË∂Ö„Åà„ÇãÂ†¥Âêà„ÅØËá™ÂãïÊîπË°å
        while (line.length > maxCharsPerLine && newLines.length < maxLines - 1) {
            newLines.push(line.substring(0, maxCharsPerLine));
            line = line.substring(maxCharsPerLine);
            modified = true;
        }
        
        // ÊÆã„Çä„ÅÆÊñáÂ≠ó„Åæ„Åü„ÅØÊúÄÂæå„ÅÆË°å
        if (line.length > 0) {
            if (line.length > maxCharsPerLine && newLines.length >= maxLines - 1) {
                // ÊúÄÂ§ßË°åÊï∞„Å´ÈÅî„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÂàá„ÇäË©∞„ÇÅ
                newLines.push(line.substring(0, maxCharsPerLine));
                modified = true;
            } else {
                newLines.push(line);
            }
        }
        
        // ÊúÄÂ§ßË°åÊï∞„ÉÅ„Çß„ÉÉ„ÇØ
        if (newLines.length >= maxLines) {
            break;
        }
    }
    
    if (modified) {
        const newText = newLines.join('\n');
        textarea.value = newText;
        
        // „Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„ÇíË™øÊï¥
        const newPos = Math.min(cursorPos, textarea.value.length);
        textarea.setSelectionRange(newPos, newPos);
        
        // Ë¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
        textarea.style.backgroundColor = '#e8f5e8';
        setTimeout(() => {
            textarea.style.backgroundColor = 'transparent';
        }, 200);
        
        console.log(`‚úÖ Ëá™ÂãïÊîπË°åÈÅ©Áî®: ${newLines.length}Ë°å„Å´ÂÜçÊßãÊàê`);
    }
}

/**
 * „Ç≠„ÉºÂÖ•Âäõ„ÅÆ„Éè„É≥„Éâ„É™„É≥„Ç∞
 */
function handleAnswerKeyInput(e, textarea) {
    // Âà∂Âæ°„Ç≠„Éº„ÅØË®±ÂèØ
    if (e.ctrlKey || e.metaKey || e.altKey) return;
    
    // Á∑®ÈõÜ„Ç≠„Éº„ÅØË®±ÂèØ
    const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Home', 'End', 'Tab'];
    if (allowedKeys.includes(e.key)) return;
    
    // Enter„Ç≠„Éº„ÅÆÂà∂Âæ°
    if (e.key === 'Enter') {
        const lines = textarea.value.split('\n');
        if (lines.length >= 23) {
            e.preventDefault();
            showTemporaryMessage('‚ùå ÊúÄÂ§ß23Ë°å„Åß„Åô');
            return;
        }
    }
    
    // ÈÄöÂ∏∏ÊñáÂ≠ó„ÅÆÂà∂Âæ°„ÅØËá™ÂãïÊîπË°å„Å´‰ªª„Åõ„ÇãÔºàÂà∂Èôê„Åó„Å™„ÅÑÔºâ
    // 30ÊñáÂ≠óË∂ÖÈÅéÊôÇ„ÅØËá™ÂãïÁöÑ„Å´Ê¨°„ÅÆË°å„Å´Áßª„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü
}

/**
 * ÊñáÂ≠óÊÉÖÂ†±„ÇíÊõ¥Êñ∞
 */
function updateCharacterInfo(textarea) {
    const lines = textarea.value.split('\n');
    const charCount = textarea.value.replace(/\n/g, '').length;
    const lineCount = lines.length;
    
    // ÊúÄÈï∑Ë°å„ÅÆÊñáÂ≠óÊï∞
    const maxLineLength = Math.max(...lines.map(line => line.length));
    
    const infoElement = document.getElementById('char-info');
    if (!infoElement) return;
    
    let text = `${charCount}ÊñáÂ≠ó / ${lineCount}Ë°å`;
    let className = 'char-info';
    
    // Âà∂Á¥ÑÈÅïÂèç„ÅÆË≠¶Âëä
    if (lineCount > 23) {
        text += ' (Ë°åÊï∞Ë∂ÖÈÅé)';
        className += ' error';
    } else if (lineCount > 20) {
        text += ' (Ë°åÊï∞Âà∂Èôê„Å´Ëøë„Å•„ÅÑ„Å¶„ÅÑ„Åæ„Åô)';
        className += ' warning';
    }
    
    // 30ÊñáÂ≠óÂà∂Èôê„ÅÆË≠¶Âëä„ÅØÂâäÈô§ÔºàËá™ÂãïÊîπË°å„ÅÆ„Åü„ÇÅÔºâ
    
    infoElement.textContent = text;
    infoElement.className = className;
}

/**
 * ‰∏ÄÊôÇÁöÑ„Å™„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
 */
function showTemporaryMessage(message) {
    const msg = document.createElement('div');
    msg.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #dc3545;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 10000;
        font-weight: bold;
    `;
    msg.textContent = message;
    document.body.appendChild(msg);
    
    setTimeout(() => {
        if (msg.parentNode) msg.remove();
    }, 1500);
}

/**
 * „É™„Çµ„Ç§„Ç∫„Éè„É≥„Éâ„É™„É≥„Ç∞
 */
function handleAnswerViewResize() {
    setTimeout(() => {
        adjustFontSizeFor30Chars();
    }, 100);
}

/**
 * Á≠îÊ°à„Çí„ÇØ„É™„Ç¢
 */
window.clearAnswerText = function() {
    const textarea = document.getElementById('answer-textarea');
    if (textarea) {
        textarea.value = '';
        updateCharacterInfo(textarea);
    }
    console.log('üóëÔ∏è Á≠îÊ°à„ÇØ„É™„Ç¢ÂÆå‰∫Ü');
};

/**
 * ‰∏ãÊõ∏„Åç‰øùÂ≠ò
 */
window.saveDraftAnswer = function() {
    const textarea = document.getElementById('answer-textarea');
    if (textarea && textarea.value.trim()) {
        localStorage.setItem('answerDraft', textarea.value);
        showTemporaryMessage('üíæ ‰∏ãÊõ∏„Åç„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
    } else {
        showTemporaryMessage('‚ùå ‰øùÂ≠ò„Åô„ÇãÂÜÖÂÆπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
    }
};

/**
 * ‰∏ãÊõ∏„ÅçË™≠Ëæº
 */
window.loadDraftAnswer = function() {
    const textarea = document.getElementById('answer-textarea');
    const draft = localStorage.getItem('answerDraft');
    
    if (textarea && draft) {
        textarea.value = draft;
        enforceAnswerConstraints(textarea);
        updateCharacterInfo(textarea);
        showTemporaryMessage('üìÇ ‰∏ãÊõ∏„Åç„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
    } else {
        showTemporaryMessage('‚ùå ‰øùÂ≠ò„Åï„Çå„Åü‰∏ãÊõ∏„Åç„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
    }
};

/**
 * „Çµ„É≥„Éó„É´Á≠îÊ°à„ÇíÊåøÂÖ•
 */
window.insertSampleAnswer = function() {
    const textarea = document.getElementById('answer-textarea');
    if (textarea) {
        const sample = `Êú¨‰ª∂„Å´„Åä„ÅÑ„Å¶„ÅØ„ÄÅ„Åæ„ÅöÂ•ëÁ¥Ñ„ÅÆÊàêÁ´ãË¶Å‰ª∂„Å´„Å§„ÅÑ„Å¶Ê§úË®é„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„ÄÇÊ∞ëÊ≥ïÁ¨¨‰∫îÁôæ‰∫åÂçÅ‰∫åÊù°„Å´„Çà„Çã„Å®„ÄÅÂ•ëÁ¥Ñ„ÅØÁî≥Ëæº„Åø„Å®ÊâøË´æ„Å´„Çà„ÇäÊàêÁ´ã„Åô„Çã„ÄÇÊú¨‰ª∂„Åß„ÅØ„ÄÅÁî≤„ÅÆË°åÁÇ∫„ÅåÁî≥Ëæº„Åø„Å´Ë©≤ÂΩì„Åô„Çã„Åã„ÄÅ‰πô„ÅÆË°åÁÇ∫„ÅåÊâøË´æ„Å´Ë©≤ÂΩì„Åô„Çã„Åã„ÇíÊ§úË®é„Åô„Çã„ÄÇÁî≥Ëæº„Åø„Å®„ÅØ„ÄÅÂ•ëÁ¥Ñ„ÅÆÊàêÁ´ã„Å´ÂøÖË¶Å„Å™‰∫ãÈ†Ö„ÇíÊòéÁ¢∫„Å´„Åó„Å¶Áõ∏ÊâãÊñπ„Å´ÊèêÁ§∫„Åô„ÇãÊÑèÊÄùË°®Á§∫„Åß„ÅÇ„Çã„ÄÇÊú¨‰ª∂Áî≤„ÅÆË°åÁÇ∫„ÅØ„ÄÅÂÖ∑‰ΩìÁöÑ„Å™Êù°‰ª∂„ÇíÁ§∫„Åó„Å¶„Åä„ÇäÁî≥Ëæº„Åø„Å®Ë™ç„ÇÅ„Çâ„Çå„Çã„ÄÇÊâøË´æ„Å®„ÅØÁî≥Ëæº„Åø„Å´ÂØæ„Åô„ÇãÂêåÊÑè„ÅÆÊÑèÊÄùË°®Á§∫„Åß„ÅÇ„Çã„ÄÇ‰πô„ÅÆË°åÁÇ∫„ÅØÊòéÁ¢∫„Å™ÂêåÊÑè„ÇíÁ§∫„Åó„Å¶„Åä„ÇäÊâøË´æ„Å®Ë™ç„ÇÅ„Çâ„Çå„Çã„ÄÇ„Çà„Å£„Å¶Êú¨‰ª∂Â•ëÁ¥Ñ„ÅØÊúâÂäπ„Å´ÊàêÁ´ã„Åó„Å¶„ÅÑ„Çã„Å®ËÄÉ„Åà„Çâ„Çå„Çã„ÄÇ`;
        
        textarea.value = sample;
        enforceAnswerConstraints(textarea);
        updateCharacterInfo(textarea);
        showTemporaryMessage('üìù „Çµ„É≥„Éó„É´„ÇíÊåøÂÖ•„Åó„Åæ„Åó„ÅüÔºàËá™ÂãïÊîπË°åÈÅ©Áî®Ôºâ');
    }
};

/**
 * AIÊ∑ªÂâä„ÇíÈñãÂßã
 */
window.startAICorrection = function() {
    const textarea = document.getElementById('answer-textarea');
    const resultArea = document.getElementById('correction-result');
    
    if (!textarea || !textarea.value.trim()) {
        showTemporaryMessage('‚ùå Á≠îÊ°à„ÅåÂÖ•Âäõ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
        return;
    }
    
    if (resultArea) {
        resultArea.innerHTML = `
            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
                <h4 style="margin: 0 0 10px 0; color: #007bff;">ü§ñ AIÊ∑ªÂâäÁµêÊûú</h4>
                <div style="margin-bottom: 10px;">
                    <strong>üìä Âü∫Êú¨ÊÉÖÂ†±:</strong><br>
                    ÊñáÂ≠óÊï∞: ${textarea.value.replace(/\n/g, '').length}ÊñáÂ≠ó<br>
                    Ë°åÊï∞: ${textarea.value.split('\n').length}Ë°å
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>üìù ÊßãÊàêË©ï‰æ°:</strong><br>
                    Ë´ñÁêÜÁöÑ„Å™ÊßãÊàê„ÅßÊõ∏„Åã„Çå„Å¶„Åä„Çä„ÄÅÁµêË´ñ„Å´Ëá≥„ÇãÈÅéÁ®ã„ÅåÊòéÁ¢∫„Åß„Åô„ÄÇ
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>‚≠ê Á∑èÂêàË©ï‰æ°:</strong><br>
                    <span style="color: #28a745; font-weight: bold;">B+ (ËâØÂ•Ω)</span>
                </div>
                <div style="font-size: 12px; color: #6c757d; margin-top: 15px;">
                    ‚Äª „Åì„Çå„ÅØ„Éá„É¢Áî®„ÅÆÁ∞°ÊòìÊ∑ªÂâäÁµêÊûú„Åß„Åô
                </div>
            </div>
        `;
        showTemporaryMessage('‚úÖ AIÊ∑ªÂâä„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
    }
};

/**
 * Á≠îÊ°àÊ∑ªÂâä„Éì„É•„Éº„ÇíÈñâ„Åò„Çã
 */
window.closeAnswerCorrectionView = function() {
    const overlay = document.getElementById('answer-correction-overlay');
    if (overlay) {
        overlay.remove();
    }
    
    // „É™„Çµ„Ç§„Ç∫„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
    window.removeEventListener('resize', handleAnswerViewResize);
    
    console.log('‚ùå Á≠îÊ°àÊ∑ªÂâä„Éì„É•„ÉºÁµÇ‰∫Ü');
};

console.log('‚úÖ answerCorrectionView.js „É≠„Éº„ÉâÂÆå‰∫Ü');
