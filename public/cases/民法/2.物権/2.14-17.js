export default {
  // === 1. モジュール基本情報（必須） ============
  id: "minpou-kaijo-daisansha",
  title: "契約の解除と第三者",
  category: "minpou",
  citation: "ユズ、板挟みっ！？",
  rank: "A",
  tags: ["民法", "債権", "契約解除", "第三者保護", "対抗要件"],
  rightSideCharacters: ['ユズヒコ'],

  // === 2. 知識箱（必須） =======================
  knowledgeBox: '契約が解除された場合、契約は初めからなかったことになり、当事者は互いに受け取ったものを返す「原状回復義務」を負います（【民法545条1項】本文）。\nしかし、これでは契約が有効だと信じて取引に入った第三者が不利益を被る可能性があります。そこで、同項ただし書は「第三者の権利を害することはできない」と定め、第三者を保護しています。\n\n【本件の主要な論点】\n1.  **保護される「第三者」の範囲**: いつ取引に入った者か。【id:14】\n2.  **第三者の主観的要件**: 第三者は善意（事情を知らないこと）である必要があるか。【id:15】\n3.  **第三者が保護されるための対抗要件**: 不動産の場合、登記は必要か。動産の場合はどうなるか。【id:16】\n4.  **解除「後」の第三者との関係**: 解除後に現れた第三者との優劣はどう決まるか。【id:17】\n\nこれらの論点を理解することは、取引の安全を守るためのルールを学ぶ上で非常に重要です。',

  // === 3. 個別Q&A（必須） =====================
  questionsAndAnswers: [
    {
      id: 14,
      rank: 'B',
      question: '「当事者の一方がその解除権を行使したときは、各当事者は、その相手方を原状に復させる義務を負う。ただし、第三者の権利を害することはできない」（【民法545条1項】）ところ、「第三者」の意義について説明しなさい。',
      answer: '{{解除前の第三者のみ}}（取消し前の第三者と同じ）を指します。\n\n【民法545条1項】ただし書は、解除の遡及効を特に制限し、第三者の保護を図ったものであるから、第三者とは{{解除の遡及効によって害される者}}に限られます。'
    },
    {
      id: 15,
      rank: 'B',
      question: '「当事者の一方がその解除権を行使したときは、各当事者は、その相手方を原状に復させる義務を負う。ただし、第三者の権利を害することはできない」（【民法545条1項】）ところ、「第三者」として保護されるための主観的要件の要否について説明しなさい。',
      answer: '{{善意、悪意問わない}}（取消し前の第三者と異なる）とされています。\n\n理由としては、①{{解除原因が存在しても、必ずしも解除されるとは限らないこと}}、②{{条文上、善意であることは要求されていないこと}}が挙げられます。'
    },
    {
      id: 16,
      rank: 'B',
      question: '「当事者の一方がその解除権を行使したときは、各当事者は、その相手方を原状に復させる義務を負う。ただし、第三者の権利を害することはできない」（【民法545条1項】）ところ、「第三者」として保護されるための登記の要否について説明しなさい。',
      answer: '{{登記必要説}}（大判大10.5.17、最判昭45.3.26など）が採られています。\n\n【民法545条1項】ただし書は、何ら帰責性のない解除権者の犠牲の下に第三者を保護するものであるから、{{権利保護要件としての登記}}を備えるべきであるとされています。'
    },
    {
      id: 17,
      rank: 'B',
      question: '「当事者の一方がその解除権を行使したときは、各当事者は、その相手方を原状に復させる義務を負う。ただし、第三者の権利を害することはできない」（【民法545条1項】）ところ、「第三者」とは解除前の第三者をいうとする場合、解除後の第三者の関係の法律構成について説明しなさい。',
      answer: '{{取消し後の第三者と同じ}}（最判昭35.11.29）で、{{【民法177条】で処理する}}とされています。'
    }
  ],

  // === 4. 事案ストーリー（必須） ================
  story: [
    { type: 'scene', text: 'ユズヒコの中学校・昼休み' },
    { type: 'narration', text: 'ユズヒコは、ずっと欲しかった限定版のスニーカーを、フリマアプリでついに見つけ、出品者Xから購入することに成功した。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'happy', dialogue: 'やった…！ついに手に入れたぞ…！' },
    { type: 'dialogue', speaker: '藤野', expression: 'normal', dialogue: 'お、ユズピ、なんか良いことあったのか？顔がニヤけてるぜ。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'smug', dialogue: 'ふっふっふ…藤野、ナスオ、これを見ろ。例の限定スニーカー、ついに買ったんだ。' },
    { type: 'dialogue', speaker: 'ナスオ', expression: 'surprised', dialogue: 'マジかよ、ユズピ！すげーじゃん！あれ、一瞬で売り切れたやつだろ！' },
    { type: 'dialogue', speaker: '藤野', expression: 'thinking', dialogue: 'フリマアプリか。つまり、出品者との間で売買契約が成立したってことだな。【民法555条】だ。' },
    { type: 'dialogue', speaker: 'ナスオ', expression: 'excited', dialogue: '所有権はいつユズピに移るんだ？契約した瞬間か？それとも商品が届いた時か？それが問題だ！' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'cool', dialogue: '【民法176条】によれば、意思表示のみで物権は移転する。だから理論上はもう俺の物だ。あとは引渡しを待つだけ…。' },
    { type: 'narration', text: 'しかし、その日の放課後、ユズヒコのスマホにフリマアプリから一件のメッセージが届いた。' },
    { type: 'scene', text: 'タチバナ家・ユズヒコの部屋' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'surprised', dialogue: 'え…なんだこれ…。' },
    { type: 'narration', text: 'メッセージの送り主は出品者Xだった。「申し訳ありません。あなたが購入した後で、もっと高値で買いたいという方が現れました。大変恐縮ですが、あなたとの取引はキャンセルさせてください。支払われた代金は全額返金します」' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'angry', dialogue: 'はぁ！？なんだよそれ！勝手すぎるだろ！' },
    { type: 'dialogue', speaker: 'みかん', expression: 'normal', dialogue: 'ユズ、どうしたのよー、うるさいわね。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'annoyed', dialogue: '姉ちゃん…ちょっと聞いてくれよ…。' },
    { type: 'narration', text: 'ユズヒコが事情を説明すると、みかんは憤慨した。' },
    { type: 'dialogue', speaker: 'みかん', expression: 'angry', dialogue: 'なによそれ！ひどい！そんなの絶対おかしいって！こっちはもう買ったんでしょ！？' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'thinking', dialogue: 'うん…でも、相手は契約を解除するって言ってる。これが法的にどう扱われるかだな…。' },
    { type: 'narration', text: 'モヤモヤしたユズヒコは、そのスニーカーについてSNSで検索してみた。すると、信じられない投稿を発見する。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'desperate', dialogue: 'うそだろ…これ、俺が買ったはずのスニーカーじゃんか…。' },
    { type: 'narration', text: '投稿していたのは、なんと同じクラスの石田だった。「念願の限定スニーカー、ゲットだぜ…ふふふ…」というコメントと共に、写真がアップされている。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'serious', dialogue: '出品者Xは、俺との契約を一方的に反故にして、石田に売ったんだ…。' },
    { type: 'scene', text: '翌日・ユズヒコの中学校の教室' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'sad', dialogue: '…というわけで、俺のスニーカーは今、石田の手に渡ってるんだ。' },
    { type: 'dialogue', speaker: '藤野', expression: 'angry', dialogue: 'うわー、それはひどい話だな！二重譲渡じゃないか！' },
    { type: 'dialogue', speaker: 'ナスオ', expression: 'passionate', dialogue: 'これは由々しき事態だぞ、ユズピ！君の所有権はどうなるんだ！？' },
    { type: 'embed',
      format: 'mermaid',
      title: '登場人物の法律関係（当初）',
      description: 'ユズヒコと出品者X、そして石田の関係性を整理してみよう。',
      content: `graph LR
    subgraph "売買契約"
        X[出品者X<br/>売主] -->|スニーカー引渡請求権| Y[ユズヒコ<br/>第一買主]
        Y -->|代金支払請求権| X
    end

    subgraph "第三者の登場"
        I[石田<br/>第二買主]
    end

    X -- 二重譲渡 --> I

    classDef party fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    class X,Y,I party`
    },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'thinking', dialogue: '問題は、出品者Xが俺に「契約を解除する」と言ってきたことなんだ。この解除と、第三者である石田との関係がどうなるのか…。' },
    { type: 'dialogue', speaker: '藤野', expression: 'thinking', dialogue: 'Xの解除は、債務不履行みたいな正当な理由がないから、そもそも有効なのか？っていう疑問もあるけどな。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'serious', dialogue: '仮に、Xの解除が有効だったと仮定して考えてみよう。その場合、俺と石田、どっちがスニーカーの所有権を主張できるんだ？' },
    { type: 'narration', text: 'ユズヒコは頭の中で【民法545条1項】を思い浮かべた。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'thinking', dialogue: '「…ただし、第三者の権利を害することはできない。」この条文が適用されるはずだ。' },
    { type: 'dialogue', speaker: 'ナスオ', expression: 'excited', dialogue: '出た！解除と第三者の論点！つまり、石田がその「第三者」にあたるかってことだな！' },
    { type: 'embed',
      format: 'mermaid',
      title: '解除と第三者の判断フロー',
      description: '石田が【民法545条1項】ただし書で保護されるかどうかの流れを見てみよう。',
      content: `flowchart TD
    A[Xとユズヒコの契約成立] --> B{Xが石田に売却<br/>(二重譲渡)}
    B --> C{石田がスニーカーの<br/>引渡しを受ける}
    A --> D{Xがユズヒコとの<br/>契約を解除}
    D --> E{石田は保護されるか？<br/>【民法545条1項】ただし書の検討}
    E --> F{保護要件を満たす？}
    F -->|YES| G[石田が所有権を確定的に取得]
    F -->|NO| H[ユズヒコが所有権を主張可能]

    classDef process fill:#dbeafe,stroke:#3b82f6,stroke-width:2px
    classDef decision fill:#fef3c7,stroke:#f59e0b,stroke-width:2px
    classDef success fill:#d1fae5,stroke:#10b981,stroke-width:2px
    classDef failure fill:#fee2e2,stroke:#ef4444,stroke-width:2px

    class A,B,C,D process
    class E,F decision
    class G success
    class H failure`
    },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'serious', dialogue: 'まず、この「第三者」は、いつ登場した人のことを指すんだろう？【id:14】' },
    { type: 'dialogue', speaker: '藤野', expression: 'impressed', dialogue: 'それは「解除前の第三者」に限られるはずだ。判例もそう言ってる。石田は、Xが解除の意思表示をする前にXから買ってるから、まさに解除前の第三者だな。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'thinking', dialogue: 'なるほど。じゃあ次の問題だ。石田が保護されるために、彼女は善意、つまり俺との契約があったことを知らない必要はあるのかな？【id:15】' },
    { type: 'dialogue', speaker: 'ナスオ', expression: 'smug', dialogue: 'いや、それは必要ない！判例では善意・悪意を問わないとされてるぜ！なぜなら、解除権が発生していても、本当に権利が行使されるかは分からないからな！' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'surprised', dialogue: 'え、悪意でもいいのか…。じゃあ、石田が俺との契約を知ってて買ったとしても保護される可能性があるってことか。' },
    { type: 'dialogue', speaker: '藤野', expression: 'serious', dialogue: '待てよ。でも、第三者が保護されるには、何か権利を確定させるための要件が必要なんじゃないか？不動産なら登記が必要だろ。【id:16】' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'impressed', dialogue: 'そうなんだ。判例は登記みたいな対抗要件を要求してる。今回のスニーカーは動産だから、対抗要件は【民法178条】の「引渡し」だ。' },
    { type: 'dialogue', speaker: 'ナスオ', expression: 'excited', dialogue: 'ということは！石田はもうスニーカーの引渡しを受けてる！つまり、対抗要件を備えてるってことだ！' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'desperate', dialogue: '結論として…石田は解除前の第三者で、善意・悪意は問われず、対抗要件である引渡しを備えている…。だから、彼女が保護されて、スニーカーの所有権を確定的に取得する可能性が高いってことか…。' },
    { type: 'dialogue', speaker: '藤野', expression: 'sad', dialogue: '悔しいけど、法律的にはそうなりそうだな、ユズピ…。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'thinking', dialogue: 'ちなみに、もしXが俺との契約を解除した「後」に、石田に売った場合はどうなるんだ？【id:17】' },
    { type: 'dialogue', speaker: 'ナスオ', expression: 'cool', dialogue: 'その場合は話が別だ！解除によって所有権はXに復帰する。その後の譲渡は、単なる二重譲渡と同じ。ユズピと石田は対抗関係に立つことになる！' },
    { type: 'dialogue', speaker: '藤野', expression: 'normal', dialogue: 'つまり、結局は対抗要件、この場合は先に引渡しを受けた方が勝つってことだな。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'normal', dialogue: 'なるほどな…。どちらのケースでも、先に引渡しを受けた石田が有利な状況は変わらないのか。' },
    { type: 'narration', text: '法律関係を整理できたものの、ユズヒコの気持ちは晴れない。' },
    { type: 'dialogue', speaker: '須藤', expression: 'normal', dialogue: 'タチバナくん、藤野くん、那須野くん。何やら難しい顔してるけど、どうしたの？' },
    { type: 'dialogue', speaker: '藤野', expression: 'blush', dialogue: 'す、須藤さん！いや、その、ちょっと法律のことで…。' },
    { type: 'narration', text: 'ユズヒコが掻い摘んで事情を話すと、須藤は静かに頷いた。' },
    { type: 'dialogue', speaker: '須藤', expression: 'thinking', dialogue: 'なるほどね…。石田さんとの関係ではそうかもしれないけど、タチバナくんは出品者のXさんに対して、約束を守らなかったことについて何か言えないの？' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'impressed', dialogue: '…！そうか。Xの行為は、俺に対する債務不履行だ。それに基づいて損害賠償請求をすることはできるはずだ。' },
    { type: 'dialogue', speaker: '須藤', expression: 'happy', dialogue: 'うん。スニーカーは手に入らないかもしれないけど、泣き寝入りする必要はないと思うよ。' },
    { type: 'dialogue', speaker: 'ユズヒコ', expression: 'happy', dialogue: '須藤さん、ありがとう。なんだか、少しすっきりしたよ。やるべきことが見えてきた。' },
    { type: 'narration', text: '友人たちとの議論と須藤のアドバイスのおかげで、ユズヒコは複雑な法律問題に立ち向かう勇気を得たのだった。' }
  ],
  // === 5. 判旨と解説（必須） ====================
  explanation: `
    <h3 class="text-xl font-bold mb-4">契約解除と第三者保護【民法545条】</h3>
    <p class="mb-4">
      一度有効に成立した契約でも、当事者の一方に債務不履行などがあった場合、もう一方の当事者は契約を解除することができます。契約が解除されると、その効力は契約時に遡って消滅し（遡及効）、各当事者は受け取ったものを相手に返す義務（原状回復義務）を負います（【民法545条1項】本文）。
      しかし、これでは契約が有効であると信じて、契約当事者から目的物を譲り受けるなどした第三者が不測の損害を被る恐れがあります。そこで、取引の安全を保護するため、【民法545条1項】はただし書で「第三者の権利を害することはできない」と定め、一定の要件を満たす第三者を保護しています。
    </p>

    <h4 class="text-lg font-bold mt-6 mb-2">保護される「第三者」の要件</h4>
    <p class="mb-4">
      判例・通説によれば、【民法545条1項】ただし書で保護される第三者と認められるためには、以下の要件を満たす必要があります。
    </p>
    <ul class="list-disc list-inside mb-4 pl-4 space-y-2">
      <li><span class="font-bold">1. 解除「前」の第三者であること【id:14】</span>: 保護の対象となるのは、解除の意思表示がなされる前に、解除された契約から生じた法律関係を基礎として、新たな独立した権利を取得した者に限られます。解除の遡及効によって影響を受ける立場にあるからです。</li>
      <li><span class="font-bold">2. 善意・悪意を問わないこと【id:15】</span>: 第三者が解除権発生の原因を知っていたか（悪意）どうかは、保護の要件とされていません。これは、解除権が発生したからといって、必ずしも権利者がそれを行使するとは限らないため、悪意の第三者を保護から一律に排除するのは妥当ではないと考えられるからです。これは、取消し前の第三者が善意無過失を要求される点と大きく異なります。</li>
      <li><span class="font-bold">3. 権利保護要件（対抗要件）を備えていること【id:16】</span>: 第三者が保護されるためには、取得した権利について対抗要件を備える必要があると解されています。不動産であれば「登記」、動産であれば「引渡し」がこれにあたります。これは、解除権者と第三者との利益調整を図るため、第三者にも一定の権利保護努力を求める趣旨です。</li>
    </ul>

    <h4 class="text-lg font-bold mt-6 mb-2">解除「後」の第三者との関係</h4>
    <p class="mb-4">
      契約が解除された「後」に現れた第三者との関係は、【民法545条1項】ただし書の直接の適用場面ではありません。解除によって目的物の所有権は元の所有者（売主）に復帰します。その後に売主から目的物を譲り受けた第三者と、解除によって所有権を取り戻した買主との関係は、二重譲渡と同様の対抗問題として扱われます（最判昭35.11.29）。
      したがって、不動産であれば【民法177条】、動産であれば【民法178条】に基づき、先に登記や引渡しといった対抗要件を備えた方が所有権を主張できることになります【id:17】。
    </p>

    <div class="bg-yellow-100 p-4 rounded-lg mt-6">
      <h5 class="font-bold text-yellow-800">司法試験ポイント</h5>
      <p>
        解除と第三者の問題では、第三者が登場したタイミングが「解除前」か「解除後」かで、適用されるルールが全く異なる点を正確に理解することが極めて重要です。「解除前」の第三者は【民法545条1項】ただし書の要件（特に対抗要件の具備）で判断し、「解除後」の第三者との関係は【民法177条】（または【民法178条】）の対抗問題として処理します。この二つの場面を混同しないよう、事案の時系列を正確に把握する癖をつけましょう。
      </p>
    </div>
  `,

  // === 6. ミニ論文問題（必須） ==================
  quiz: [
    {
      title: "売買契約の解除と二重譲渡",
      rank: "A",
      background: `ユズヒコは、出品者Xからフリマアプリで希少な限定スニーカーを10万円で購入する契約（以下「本件売買契約」という。）を締結し、代金を支払った。ところが、Xは気が変わり、ユズヒコに対して「契約はなかったことにしてほしい」と一方的に通知して契約を解除した。その翌日、Xはこの事情を知っているユズヒコのクラスメートである石田に、同じスニーカーを15万円で売却し、即日引き渡した。
ユズヒコは、スニーカーの所有権は自分にあると信じ、現にスニーカーを所持している石田に対して、その引渡しを請求したいと考えている。`,
      subProblems: [
        {
          title: "解除前の第三者に対する引渡請求",
          rank: "A",
          relatedQAs: [14, 15, 16],
          problem: "ユズヒコの石田に対するスニーカー引渡請求は法的に認められるか。【民法545条1項】ただし書の解釈を論じた上で結論を述べなさい。",
          hint: "石田が【民法545条1項】ただし書にいう「第三者」として保護されるための要件を一つずつ検討し、本件の事実をあてはめてみましょう。",
          points: [
            "【民法545条1項】ただし書の趣旨（取引の安全保護）",
            "保護される「第三者」の要件①（解除前の第三者であること）",
            "保護される「第三者」の要件②（善意・悪意を問わないこと）",
            "保護される「第三者」の要件③（対抗要件を具備していること）",
            "本件へのあてはめと結論"
          ],
          modelAnswer: "１．ユズヒコの請求の法的根拠\nユズヒコは、Xとの本件売買契約に基づきスニーカーの所有権を取得したと主張し、所有権に基づく返還請求権（【民法206条】、【民法198条】）の一環として、石田に引渡しを請求していると考えられる。\n\n２．【民法545条1項】ただし書の「第三者」の意義\n契約が解除されると、その効果は契約時に遡り、当事者は原状回復義務を負う。しかし、これでは取引の安全が害されるため、【民法545条1項】ただし書は第三者を保護している。判例・通説によれば、この「第三者」として保護されるためには、①解除前に、②解除された契約から生じた法律関係を基礎として新たな利害関係に入り、かつ、③権利保護要件（対抗要件）を備えた者でなければならないと解されている。\n\n３．本件における石田の該当性\n（１）石田は、Xによる解除の意思表示がなされた「後」にXからスニーカーを購入している。しかし、判例は解除の意思表示があっても、それに基づく原状回復としての登記や引渡しが完了するまでは、解除「前」の第三者と同様に扱うべきとする（実質的判断）。本問では解除後に譲渡されているが、原状回復が未了であるため、解除前の第三者に関する議論が妥当する。\n（２）主観的要件について、判例は第三者の善意・悪意を問わないとしている【id:15】。したがって、石田がXとユズヒコとの契約の事情を知っていた（悪意）としても、保護の障害とはならない。\n（３）対抗要件について、動産であるスニーカーの所有権移転の対抗要件は「引渡し」である（【民法178条】）。石田はXから現実にスニーカーの引渡しを受けており、対抗要件を具備している【id:16】。\n\n４．結論\n以上より、石田は【民法545条1項】ただし書によって保護される「第三者」に該当する。その結果、ユズヒコは解除を石田に対抗できず、スニーカーの所有権を主張して引渡しを求めることはできない。したがって、ユズヒコの請求は認められない。"
        },
        {
          title: "解除後の法律関係",
          rank: "B",
          relatedQAs: [17],
          problem: "上記の事案と異なり、Xがユズヒコに契約解除を通知し、ユズヒコもこれを了承してスニーカーがXに返還された（原状回復が完了した）「後」に、Xが石田にスニーカーを売却して引き渡したと仮定する。この場合のユズヒコと石田の法律関係はどのように考えられるか。",
          hint: "解除によって一度Xに所有権が完全に復帰した後の話です。【民法545条1項】ただし書の問題ではなく、別の条文で処理されることになります。",
          points: [
            "解除後の法律関係の性質（対抗問題）",
            "適用条文（【民法177条】または【民法178条】）",
            "本件における結論"
          ],
          modelAnswer: "この場合、Xとユズヒコの間の契約関係は解除によって完全に清算され、スニーカーの所有権はXに復帰している。その後にXが石田に売却する行為は、もはやユズヒコとは直接関係のない新たな取引である。\n\n仮に、解除に無効原因などがあり、ユズヒコが所有権を主張するような特殊な状況が生じたとしても、その法律関係は解除「後」の第三者との関係として、二重譲渡に類似した対抗問題となる【id:17】。すなわち、動産であるスニーカーの所有権の帰属は、【民法178条】に従い、対抗要件である引渡しを先に具備した方が優先される。\n\n本件では、石田がXから引渡しを受けているため、石田が完全に所有権を取得する。ユズヒコが後から所有権を主張することはできない。"
        }
      ]
    }
  ],

  // === 7. 論文トレーニング（廃止） ================
  essay: null
};
